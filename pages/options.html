<!DOCTYPE html>
<html>
<head><title>SmoothScroll Options</title>
<style type="text/css">
body {
         font-size: 13.4px;
         font-family: Verdana, sans-serif;
         color: #333333;
         text-align: center;
         margin: auto;
         background-color: #000000;
         }
input {
         color: #010101;
         background-color: transparent;
         padding: 3px;
         -webkit-border-radius: 4px;
         border: 1px solid #343434;
         width: 38px;
         outline: none;
         text-align: center;
}

.title {
         margin: 30px;
         color: #4400CC;
         font-size: 40px;
         background-image:url(../img/128n.png);
         width: 800px;
         height: 120px;
         background-repeat: no-repeat;
         background-position: bottom right;
         text-align: left;
         font-weight: bold;
}
a {
        text-decoration: none;
        color: #333333;
}

a:hover {
        text-decoration: underline;
        color: #444444;
}
.setting-name { width: 150px; }
.note { font-size: 80%; color: #666; padding-left: 10px; }
input[type=text] { margin-right:10px; }

</style>
<script src="../src/sscr.js"></script>


<script>

/**
 * Options page logic.
 */
(function(window, undefined){

/**
 * List of available options
 */
var options = [
  'framerate', 
  'animtime',
  'scrollsz',
  'arrscroll',
  //'pgscroll',
  'pulseAlgorithm',
  'pulseScale',
  'pulseNormalize',
  'keyboardsupport',
  'exclude'
];

function byId(id) { return document.getElementById(id); }

function isNodeName(el, tag) {
    return el.nodeName.toLowerCase() === tag.toLowerCase();
}

/**
 * Fills up the form with the saved values from local storage.
 */
function init() {
    options.forEach(function(key, i) {
        if (/keyboardsupport|pulseAlgorithm/.test(key)) {
            byId(key).checked = (localStorage[key] == "true");
        } else if (localStorage[key]) {
            byId(key).value = localStorage[key];
        }
    });
}

/**
 * Saves the values from the form to local storage.
 */
function save() {

    var i, key, opt, elem, error;

    // save options to the local storage
    options.forEach(function(key, i) {
        // <input type="text"> and <textarea>
        if (!/keyboardsupport|pulseAlgorithm/.test(key)) {
            elem = byId(key);
            opt = elem.value;
            // every <input> 
            if (isNodeName(elem, "input")) {
              // should be a number
              opt = parseInt(opt, 10);
              if (isNaN(opt)) {
                  error = "Numeric Values Only!";
                  return; // stop iteration
               }
            }
            localStorage[key] = opt;
        } else { // keyboardsupport | pulseAlgorithm
            localStorage[key] = byId(key).checked;
        }
    });

    // update message
    if (!error) {
        var saving  = byId("saving");
        var message = byId("message");
        saving.innerHTML  = "Settings saved!";
        message.innerHTML = '<a href="#" onclick="reload()">' +
                            'Reload this page and test the new scroll settings!</a>';
        setTimeout(function () {
            saving.innerHTML = "&nbsp;";
        }, 1500);
    }
    // error message
    else {
        alert(error);
    } 
}

function get_manifest(callback) {
    var xhr = new XMLHttpRequest();
    xhr.onload = function () {
        callback(JSON.parse(xhr.responseText));
    };
    xhr.open('GET', '../manifest.json', true);
    xhr.send(null);
}

get_manifest(function (manifest) {
    version = manifest.version;
    byId("version").innerHTML = version;
});

function reload() {
    window.location.reload();
}

// Restores select box state to saved value from localStorage.
//function restore_options() {
//}

// public interface
window.onload = init;
window.reload = reload;
window.save = save;

})(window);
</script>

</head>
<body style="width: 100%; background-color: #FFFFFF; text-align: center;">
<center>


<div class="title">SmoothScroll <span style="color: #CBCBCB; font-size: 22px; font-weight: normal;"> Version <span id="version"></span></span></div>
<div style="border: 3px solid #28AEA8; -webkit-border-radius: 20px; width: 800px; text-align: left; padding: 30px">

<span style="font-size: 16px; color: #00CCFF"><b>Scroll Settings</b></span>
<hr style="width:100%; border: 1px dotted grey; margin: 0px;"><br>
<br>
<table border="0" cellpadding="0" cellspacing="2" style="font-size: 12px; margin-left: 6px">
 <tr>
  <td class="setting-name"><label for="framerate">Frames per second</label></td>
  <td><input id="framerate" type="text" size="1" maxlength="3"> </td>
   <td><span style="color: #00CCFF; font-size: 12px;"> <i>Default value: 50</i></span></td>
   <td class="note">(higher is smoother but more CPU intensive)</td>
 </tr>
 <tr>
  <td class="setting-name"><label for="scrollsz">Step size [px]</label></td>
  <td><input id="scrollsz" type="text" size="1" maxlength="3"> </td>
  <td><span style="color: #00CCFF; font-size: 12px;"> <i>Default value: 120</i></span></td>
  <td class="note">(higher means more scrolling for each mouse event)</td>
 </tr>
 <tr>
  <td class="setting-name"><label for="animtime">Animation time [ms]</label></td>
  <td><input id="animtime" type="text" size="1" maxlength="3"> </td>
  <td><span style="color: #00CCFF; font-size: 12px;"> <i>Default value: 400</i></span></td>
  <td class="note">(higher number stretches animation)</td>
 </tr>
</table>
<br>
<br>

<b>Pulse Algorithm</b><br><br>

<input type="checkbox" id="pulseAlgorithm"><label for="pulseAlgorithm">Enable pulse algorithm</label><br><br>

<table border="0" cellpadding="0" cellspacing="2" style="font-size: 12px; margin-left: 6px">
 <tr>
  <td class="setting-name"><label for="pulseScale">Pulse Scale</label></td>
  <td><input id="pulseScale" type="text" size="1" maxlength="2"></td>
     <td><span style="color: #00CCFF; font-size: 12px;"> <i>Default value: 8</i></span></td>
 </tr>
 <tr>
  <td class="setting-name"><label for="pulseNormalize">Pulse Normalize</label></td>
  <td><input id="pulseNormalize" type="text" size="1" maxlength="2"></td>
     <td><span style="color: #00CCFF; font-size: 12px;"> <i>Default value: 1</i></span></td>
 </tr>
</table>

<br><br>
<span style="font-size: 16px; color: #00CCFF"><b>Keyboard Settings</b></span>
<hr style="width:100%; border: 1px dotted grey; margin: 0px;"><br>
<input type="checkbox" id="keyboardsupport"><label for="keyboardsupport">Enable keyboard support</label><br><br>

<table border="0" cellpadding="0" cellspacing="2" style="font-size: 12px; margin-left: 39px">
 <tr>
  <td style="width:200px;"><label for="arrscroll">Arrow key step size [px]</label></td>
  <td><input id="arrscroll" type="text" size="1" maxlength="3"> </td>
  <td><span style="color: #00CCFF; font-size: 12px;"> <i>Default value: 50</i></span></td>
 </tr>
 <!--
 <tr>
  <td style="width:200px;"><label for="pgscroll">PgUp/PgDown step size [px]</label></td>
  <td><input id="pgscroll" type="text" size="1" maxlength="4"> </td>
  <td><span style="color: #00CCFF; font-size: 12px;"> <i>Default value: 800</i></span></td>
 </tr>
 -->
</table>

<br><br>
<span style="font-size: 16px; color: #00CCFF"><b><label for="exclude">Excluded pages</label></b></span>
<hr style="width:100%; border: 1px dotted grey; margin: 0px;"><br>
<textarea id="exclude" cols="70" rows="5">twitter.com, gmail.com</textarea> <br><br>

<br>

<button onclick="save()" style="cursor:pointer; padding: 4px;font-size: 15px; background-color: transparent; -webkit-border-radius: 4px; border: 1px solid #111111; color: #000000">Save Settings</button>
<br><div id="saving" style="color: #00CCFF; font-size: 12px; font-weight: bold">&nbsp;</div>
<br><div id="message" style="color: #00CCFF; font-size: 11px;"></div>
<br>
<span style="font-size: 16px; color: #00CCFF"><b>Links</b></span>
<hr style="width:100%; border: 1px dotted grey; margin: 0px;"><br>
 - <a href="https://github.com/galambalazs/smoothscroll/">Source Code, Known Issues, Bug Report, ...</a><br>
 - <a href="https://chrome.google.com/extensions/detail/cccpiddacjljmfbbgeimpelpndgpoknn">Extension Homepage</a><br>
<br>
<span style="font-size: 16px; color: #00CCFF"><b>People involved</b></span>
<hr style="width:100%; border: 1px dotted grey; margin: 0px;"><br>
 - <a href="http://stereopsis.com/stopping/">Michael Herf: Pulse Algorithm</a><br>
 - <a href="http://frankyan.com/">Frank Yan: Direction Switching Fixes</a><br>
 - Ismael Barros: Keyboard Fixes<br>
 - Balázs Galambosi: Many improvements and bug fixes (see CHANGELOG.txt)<br>
</div>

<small>Patrick Brunner | patrickb1991&#64;gmail.com</small>
<br><br><br><br><br><br>
</center>
</body>
</html>